# MediaClassifier GUI 设计文档

## 1. 概述

MediaClassifier GUI 是基于 Slint 框架构建的图形用户界面，为用户提供直观、易用的媒体文件分类体验。本文档描述了 GUI 的设计规范和实现细节。

### 1.1 技术选型

- **GUI 框架**：[Slint](https://slint.dev/) - 现代化、高性能的 Rust GUI 框架
- **设计语言**：Slint DSL (.slint 文件)
- **集成方式**：通过 `slint-build` 编译时生成 Rust 代码

### 1.2 设计目标

- 简洁直观的用户界面
- 与 CLI 功能完全对等
- 实时反馈处理进度
- 支持跨平台运行（Windows、macOS、Linux）

## 2. 界面布局

### 2.1 整体结构

```
┌─────────────────────────────────────────────────────────────┐
│                    🎬 MediaClassifier                        │  标题栏
├─────────────────────────────────────────────────────────────┤
│  📁 目录设置                                                 │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 工作目录: [____________________________] [浏览...]       ││
│  │ 配置文件: [____________________________] [浏览...][查看] ││
│  └─────────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────────┤
│  [🔍 扫描文件]  [▶️ 开始分类]  [⏹️ 停止]  ☑ 处理后清理空目录   │  操作区
├─────────────────────────────────────────────────────────────┤
│  [████████████████████░░░░░░░░░░░░░░░░░░░░] 65%              │  进度条
├─────────────────────────────────────────────────────────────┤
│  📋 媒体文件列表 (156 个文件)                                │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 文件名           │ 类型  │ 大小    │ 状态               ││
│  │──────────────────┼───────┼─────────┼────────────────────││
│  │ IMG_1234.jpg     │ JPG   │ 2.5 MB  │ 成功               ││
│  │ DSC_5678.NEF     │ NEF   │ 25 MB   │ 处理中...          ││
│  │ video.mov        │ MOV   │ 150 MB  │ 等待               ││
│  │ ...              │       │         │                    ││
│  └─────────────────────────────────────────────────────────┘│  文件列表
├─────────────────────────────────────────────────────────────┤
│  📊 统计信息                                                 │
│  总计: 156  ✅ 成功: 120  🔄 重命名: 5  ⏭️ 跳过: 10  ❌ 失败: 2 │  统计区
├─────────────────────────────────────────────────────────────┤
│  🟢 就绪                                                     │  状态栏
└─────────────────────────────────────────────────────────────┘
```

### 2.2 窗口尺寸

| 属性 | 值 |
|------|-----|
| 最小宽度 | 800px |
| 最小高度 | 600px |
| 推荐宽度 | 1024px |
| 推荐高度 | 768px |

## 3. 组件详细设计

### 3.1 标题栏

- **内容**：应用图标 + 应用名称 "🎬 MediaClassifier"
- **字体**：24px，粗体
- **对齐**：居中

### 3.2 目录设置区 (GroupBox)

#### 工作目录行
| 组件 | 类型 | 说明 |
|------|------|------|
| 标签 | Text | "工作目录:"，宽度 80px |
| 输入框 | LineEdit | 显示/编辑目录路径，支持手动输入 |
| 浏览按钮 | Button | 打开目录选择对话框 |

#### 配置文件行
| 组件 | 类型 | 说明 |
|------|------|------|
| 标签 | Text | "配置文件:"，宽度 80px |
| 输入框 | LineEdit | 显示/编辑配置文件路径 |
| 浏览按钮 | Button | 打开文件选择对话框 |
| 查看按钮 | Button | 显示当前配置详情 |

### 3.3 操作区

| 按钮 | 图标 | 功能 | 启用条件 |
|------|------|------|----------|
| 扫描文件 | 🔍 | 扫描工作目录中的媒体文件 | 空闲或完成状态 |
| 开始分类 | ▶️ | 开始分类处理 | 空闲状态且已扫描到文件 |
| 停止 | ⏹️ | 停止当前操作 | 扫描中或处理中 |

**复选框**：
- "处理后清理空目录" - 控制是否在处理完成后删除空目录

### 3.4 进度指示器

- **组件**：ProgressIndicator + 百分比文本
- **显示条件**：仅在扫描或处理状态下显示
- **进度值**：0.0 - 1.0 浮点数
- **百分比**：显示 `Math.round(progress * 100)%`

### 3.5 文件列表区 (GroupBox)

**标题格式**：`📋 媒体文件列表 ({count} 个文件)`

#### 列表项结构

| 列 | 字段 | 宽度 | 说明 |
|----|------|------|------|
| 文件名 | name | 自动扩展 | 文件名称 |
| 类型 | file_type | 60px | 文件扩展名（大写） |
| 大小 | size | 80px | 文件大小（人类可读格式） |
| 状态 | status | 100px | 处理状态 |

#### 状态颜色编码

| 状态 | 颜色 | 色值 |
|------|------|------|
| 成功 | 绿色 | #4caf50 |
| 失败 | 红色 | #f44336 |
| 等待/处理中 | 默认 | Palette.foreground |

### 3.6 统计信息区 (GroupBox)

水平排列显示以下统计项：

| 统计项 | 图标 | 颜色 |
|--------|------|------|
| 总计 | 📊 | 默认 |
| 成功 | ✅ | #4caf50 (绿色) |
| 重命名 | 🔄 | #2196f3 (蓝色) |
| 跳过 | ⏭️ | #ff9800 (橙色) |
| 失败 | ❌ | #f44336 (红色) |

### 3.7 状态栏

| 组件 | 说明 |
|------|------|
| 状态指示灯 | 8x8px 圆形，颜色随状态变化 |
| 状态消息 | 显示当前操作状态 |

#### 状态指示灯颜色

| 状态 | 颜色 | 色值 |
|------|------|------|
| 空闲 (Idle) | 绿色 | #4caf50 |
| 扫描中 (Scanning) | 蓝色 | #2196f3 |
| 处理中 (Processing) | 橙色 | #ff9800 |
| 完成 (Completed) | 绿色 | #4caf50 |

## 4. 数据结构

### 4.1 MediaFileItem (媒体文件项)

```slint
export struct MediaFileItem {
    name: string,       // 文件名
    path: string,       // 完整路径
    file_type: string,  // 文件类型（扩展名大写）
    size: string,       // 文件大小（人类可读格式）
    date: string,       // 文件日期
    status: string,     // 处理状态
}
```

### 4.2 RuleItem (分类规则)

```slint
export struct RuleItem {
    name: string,        // 规则名称
    description: string, // 规则描述
    extensions: string,  // 支持的扩展名
    enabled: bool,       // 是否启用
}
```

### 4.3 Statistics (统计信息)

```slint
export struct Statistics {
    total: int,    // 总文件数
    success: int,  // 成功数
    skipped: int,  // 跳过数
    renamed: int,  // 重命名数
    failed: int,   // 失败数
}
```

### 4.4 AppState (应用状态)

```slint
export enum AppState {
    Idle,       // 空闲
    Scanning,   // 扫描中
    Processing, // 处理中
    Completed,  // 完成
}
```

## 5. 回调函数

| 回调 | 触发时机 | 预期行为 |
|------|----------|----------|
| `browse_directory()` | 点击工作目录"浏览"按钮 | 打开目录选择对话框 |
| `browse_config()` | 点击配置文件"浏览"按钮 | 打开文件选择对话框 |
| `scan_files()` | 点击"扫描文件"按钮 | 扫描工作目录中的媒体文件 |
| `start_classification()` | 点击"开始分类"按钮 | 开始文件分类处理 |
| `stop_classification()` | 点击"停止"按钮 | 停止当前操作 |
| `show_config()` | 点击"查看"按钮 | 显示配置详情对话框 |
| `reload_config()` | 需要重新加载配置时 | 重新读取配置文件 |

## 6. 属性绑定

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `working_directory` | string | "." | 工作目录路径 |
| `config_path` | string | "~/.config/media-classifier/config.yaml" | 配置文件路径 |
| `media_files` | [MediaFileItem] | [] | 媒体文件列表 |
| `rules` | [RuleItem] | [] | 分类规则列表 |
| `stats` | Statistics | {0, 0, 0, 0, 0} | 统计信息 |
| `app_state` | AppState | Idle | 应用状态 |
| `progress` | float | 0.0 | 进度 (0.0-1.0) |
| `status_message` | string | "就绪" | 状态消息 |
| `clean_empty_dirs` | bool | true | 是否清理空目录 |

## 7. 交互流程

### 7.1 基本工作流程

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
│  启动   │ ──▶ │  设置   │ ──▶ │  扫描   │ ──▶ │  分类   │
│  应用   │     │  目录   │     │  文件   │     │  处理   │
└─────────┘     └─────────┘     └─────────┘     └─────────┘
                                     │               │
                                     ▼               ▼
                               ┌─────────┐     ┌─────────┐
                               │ 显示文件│     │ 显示结果│
                               │   列表  │     │   统计  │
                               └─────────┘     └─────────┘
```

### 7.2 状态转换图

```
        ┌──────────────────────────────────────┐
        │                                      │
        ▼                                      │
    ┌──────┐  scan_files()  ┌──────────┐       │
    │ Idle │ ─────────────▶ │ Scanning │       │
    └──────┘                └──────────┘       │
        ▲                        │             │
        │                        │ 扫描完成    │
        │                        ▼             │
        │                   ┌──────┐           │
        │                   │ Idle │           │
        │                   └──────┘           │
        │                        │             │
        │   start_classification()│             │
        │                        ▼             │
        │                  ┌────────────┐      │
        │                  │ Processing │      │
        │                  └────────────┘      │
        │                        │             │
        │                        │ 处理完成    │
        │                        ▼             │
        │                  ┌───────────┐       │
        └──────────────────│ Completed │───────┘
                           └───────────┘
```

## 8. 样式规范

### 8.1 间距

| 元素 | 值 |
|------|-----|
| 窗口内边距 | 16px |
| 组件间距 | 12px |
| 组内元素间距 | 8px |

### 8.2 颜色方案

使用 Slint 内置的 `Palette` 系统，自动适配系统主题（明/暗模式）。

自定义颜色：
- 成功/正常：#4caf50 (Material Green 500)
- 信息：#2196f3 (Material Blue 500)
- 警告：#ff9800 (Material Orange 500)
- 错误：#f44336 (Material Red 500)

### 8.3 字体

| 元素 | 大小 | 粗细 |
|------|------|------|
| 标题 | 24px | 700 (Bold) |
| 统计项标签 | 默认 | 500 (Medium) |
| 其他文本 | 默认 | 400 (Regular) |

## 9. 待实现功能

以下功能在当前设计阶段为占位实现，需要后续完成：

- [ ] 目录选择对话框集成
- [ ] 配置文件选择对话框集成
- [ ] 文件扫描逻辑（调用 mc-lib）
- [ ] 文件分类逻辑（调用 mc-lib）
- [ ] 配置详情显示对话框
- [ ] 错误提示对话框
- [ ] 操作取消/中断机制
- [ ] 多语言支持

## 10. 文件结构

```
crates/mc-gui/
├── Cargo.toml          # 项目配置
├── build.rs            # 构建脚本（编译 .slint 文件）
├── src/
│   └── main.rs         # 应用入口和回调实现
└── ui/
    └── main_window.slint  # 主窗口 UI 定义
```

## 11. 构建与运行

```bash
# 构建 GUI 应用
cargo build -p mc-gui

# 运行 GUI 应用
cargo run -p mc-gui

# 发布构建
cargo build -p mc-gui --release
```

## 12. 依赖

| 依赖 | 版本 | 用途 |
|------|------|------|
| `slint` | 1.8 | GUI 框架运行时 |
| `slint-build` | 1.8 | .slint 文件编译 |
| `mc-lib` | workspace | 核心分类功能 |
| `anyhow` | 1.0 | 错误处理 |
| `log` | 0.4 | 日志记录 |
